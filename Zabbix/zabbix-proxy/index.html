<!--
  This Basic theme serves as an example for how to create other
  themes by demonstrating the features with minimal HTML and CSS.
  Comments like this will be through the code to explain briefly
  what each feature is and point you to the MkDocs documentation
  to find out more.
-->
<!DOCTYPE html>
<head>
  
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <!--
    The page_title contains the title for a page as shown in the navigation.
    Site name contains the name as defined in the mkdocs.yml
  -->
  
  <title>Zabbix-proxy - not name</title>
  
  <!--
    You can include external assets of course, but be aware that it means the
    documentation may not work well offline.
  -->
  <link rel="stylesheet" href="../../css/pure-min.css">
  <link rel="stylesheet" href="../../css/theme.css">

  <!--
    extra_ess contains paths to CSS files in the users
    documentation directory or a list of CSS files defined in
    their mkdocs.yml.

    http://www.mkdocs.org/user-guide/configuration/#extra_css
  -->
   
  
  
  
  
  
  
</head>

<body>

  <!--
  <h1>This is an example theme for MkDocs.</h1>

  <p>
    It is designed to be read by looking at the theme HTML which is heavily
    commented. The easiest way to do that is by
    <strong><a href="https://github.com/mkdocs/mkdocs-basic-theme/tree/master/basic_theme">
    looking at the source on GitHub.</a></strong>. Otherwise this is just a
    demonstration that the theme is fully functional.
  </p>

  <hr/>
  -->
  <!--
  <h2>Documentation Navigation</h2>
  -->
  <!--
    Create the navigation for the documentation.

    Because we don't know how many levels deep the navigation is, it needs to
    be included in it's own file so it can be recursive. Otherwise the theme
    can also only support a specific number of levels.

    See the nav.html file for more details about how this works.
  -->
  

<div id="layout">

    <!-- Menu toggle -->
  <h1 class="logo-text">
	<label for="toggler">
      <i class="fas fa-bars sidebar-toggle"></i>
    </label>
  </h1>
	
	<input type="checkbox" id="toggler"/>
    <div id="menu">
      <div class="pure-menu">
	  <a class="pure-menu-heading" href="../..">Home</a>
  <ul class="pure-menu-list">
  
    <!--

-->

  <li class="pure-menu-folder">
    Тренировки
    <ul>
        
            <!--

-->

<li >
    <a href="../../%D0%A2%D1%80%D0%B5%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8/%D0%A1%D0%B8%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%82%D1%80%D0%B5%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8/" class="pure-menu-link">Силовые тренировки</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%A2%D1%80%D0%B5%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8/%D0%B2%D0%BE%D1%81%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5/" class="pure-menu-link">Восстановление</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%A2%D1%80%D0%B5%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8/%D0%B7%D0%B0%D1%80%D1%8F%D0%B4%D0%BA%D0%B0/" class="pure-menu-link">Зарядка</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%A2%D1%80%D0%B5%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8/%D1%80%D0%B0%D1%81%D1%82%D1%8F%D0%B6%D0%BA%D0%B0/" class="pure-menu-link">Статическая растяжка</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Поход
    <ul>
        
            <!--

-->

<li >
    <a href="../../%D0%9F%D0%BE%D1%85%D0%BE%D0%B4/%D0%93%D0%B8%D0%B3%D0%B8%D0%B5%D0%BD%D0%B0/" class="pure-menu-link">Гигиена</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%9F%D0%BE%D1%85%D0%BE%D0%B4/%D0%94%D0%BE%D0%BB%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8/" class="pure-menu-link">Должности</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%9F%D0%BE%D1%85%D0%BE%D0%B4/%D0%9F%D0%B8%D1%82%D0%B0%D0%BD%D0%B8%D0%B5/" class="pure-menu-link">Питание</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Питание
    <ul>
        
            <!--

-->

<li >
    <a href="../../%D0%9F%D0%B8%D1%82%D0%B0%D0%BD%D0%B8%D0%B5/%D0%91%D0%96%D0%A3/" class="pure-menu-link">БЖУ</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Кинокаталог
    <ul>
        
            <!--

-->

<li >
    <a href="../../%D0%9A%D0%B8%D0%BD%D0%BE%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3/%D0%9C%D1%83%D0%BB%D1%8C%D1%82%D1%84%D0%B8%D0%BB%D1%8C%D0%BC%D1%8B/" class="pure-menu-link">Мультфильмы</a>
</li>

        
            <!--

-->

<li >
    <a href="../../%D0%9A%D0%B8%D0%BD%D0%BE%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3/%D0%A4%D0%B8%D0%BB%D1%8C%D0%BC%D1%8B/" class="pure-menu-link">Фильмы</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Useful programs
    <ul>
        
            <!--

-->

<li >
    <a href="../../useful_programs/" class="pure-menu-link">useful opensource programms</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Zabbix
    <ul>
        
            <!--

-->

<li >
    <a href="../Partitioning/" class="pure-menu-link">Partitioning with external script for mysql/mariadb database</a>
</li>

        
            <!--

-->

<li >
    <a href="../SSO/" class="pure-menu-link">SSO in zabbix</a>
</li>

        
            <!--

-->

<li >
    <a href="../linux_template/" class="pure-menu-link">linux template</a>
</li>

        
            <!--

-->

<li >
    <a href="../mariadb/" class="pure-menu-link">Install mariadb node of galera + haproxy + keepalived</a>
</li>

        
            <!--

-->

<li >
    <a href="../mysql_monitoring/" class="pure-menu-link">Monitoring mysql/mariadb</a>
</li>

        
            <!--

-->

<li >
    <a href="../zabbix-agent/" class="pure-menu-link">install [zabbix-agent]</a>
</li>

        
            <!--

-->

<li class="pure-menu-item">
    <a href="./" class="pure-menu-link">Zabbix-proxy</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

  <li class="pure-menu-folder">
    Browser
    <ul>
        
            <!--

-->

<li >
    <a href="../../Browser/ublock/" class="pure-menu-link">uBlock Origin</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Browser/%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%B0/" class="pure-menu-link">Изменение интерфейса</a>
</li>

        
    </ul>
  </li>

  
    <!--

-->

<li >
    <a href="../.." class="pure-menu-link">Home</a>
</li>

  
  </ul>
      </div>
    </div>




<div id="main">
  <div class="content">
    
        <h1 id="zabbix-proxy">Zabbix-proxy</h1>
<h2 id="install">Install</h2>
<pre><code class="language-sh">rpm --import http://repo.zabbix.com/RPM-GPG-KEY-ZABBIX
rpm -ivh http://repo.zabbix.com/zabbix/4.2/rhel/7/x86_64/zabbix-release-4.2-1.el7.noarch.rpm
yum install zabbix-proxy-mysql -y
yum install mariadb-server -y
systemctl enable mariadb &amp;&amp; systemctl start mariadb

</code></pre>
<p>Prepare database with little script - <code>vi mysql_secure_installation.sql</code>:</p>
<pre><code class="language-sql">UPDATE mysql.user SET Password=PASSWORD('password') WHERE User='root';
DELETE FROM mysql.user WHERE User='';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';
create database zabbix character set utf8 collate utf8_bin;
grant all privileges on zabbix.* to zabbix@localhost identified by 'password';
FLUSH PRIVILEGES;
</code></pre>
<pre><code class="language-sh">mysql -sfu root &lt; mysql_secure_installation.sql

mysql -u root -p

zcat /usr/share/doc/zabbix-proxy-mysql-4.2.1/schema.sql.gz | mysql -u zabbixuser zabbix_proxy -p
</code></pre>
<p>You can use jinja template for config of zabbix-agent <code>/etc/zabbix/zabbix_proxy.conf</code>.
Default settings on agent (other options generally useless):</p>
<pre><code class="language-conf">PidFile=/var/run/zabbix/zabbix_proxy.pid
LogFile=/var/log/zabbix/zabbix_proxy.log
LogFileSize=0
Server={{ Proxy[hostname] }}
ServerActive={{ Proxy[hostname] }}
Hostname={{ Host[hostname] }} # !!!Must be like name of host in web
SocketDir=/var/run/zabbix
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix
</code></pre>
<p>If we use selinux, need allow zabbix-agent, or check that selinux disabled.
Change rules of firewalld and start:</p>
<pre><code class="language-sh">firewall-cmd --permanent --add-port=10050/tcp
firewall-cmd --permanent --add-port=10051/tcp
firewall-cmd --reload
systemctl enable zabbix-proxy &amp; systemctl start zabbix-proxy
</code></pre>
<h2 id="monitoring-in-zabbix">Monitoring in zabbix</h2>
<p>Using default template <code>Template App Zabbix Proxy</code>.
For collecting metrics from proxy, option Server/ServerActive must =<Proxy ip> in zabbix-agent config.</p>
<h2 id="upgrade"><a href="https://www.zabbix.com/documentation/5.0/manual/installation/upgrade/packages/rhel_centos">Upgrade</a></h2>
<p>While upgrading Zabbix agents is not mandatory (but recommended), Zabbix server and proxies must be of the same major version. 
Therefore, in a server-proxy setup, Zabbix server and all proxies have to be stopped and upgraded. 
Keeping proxies running during server upgrade no longer will bring any benefit as during proxy upgrade their old data will be discarded 
and no new data will be gathered until proxy configuration is synced with server. </p>
<pre><code class="language-sh">service zabbix-proxy stop &amp; service zabbix-agent stop
rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
yum upgrade zabbix-proxy-mysql zabbix-agent -y
systemctl start zabbix-proxy &amp; systemctl start zabbix-agent
</code></pre>
<h3 id="sqlite">SQLite</h3>
<p>Please note that if you have a proxy with a SQLite database, the history data of these proxies will be lost until the update.
As updating the SQLite database file is not supported and this file must be deleted manually.
When the proxy is started for the first time and the SQLite database file is missing, the proxy will create it automatically. </p>
<h3 id="playbook-for-update-on-centos-7">Playbook for update on Centos 7</h3>
<pre><code class="language-yml">    - name: STOP zabbix-proxy
      service:
        name: zabbix-proxy
        state: stopped

    - name: rpm-zabbix-5.0-1
      yum: name=https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm

    - name: UPGRADE zabbix-proxy
      yum:
        name: zabbix-proxy
        state: latest

    - name: START zabbix-proxy
      service:
        name: zabbix-proxy
        state: started
  when: 
    - ansible_facts['distribution'] == 'CentOS'
    - ansible_facts['distribution_major_version'] == &quot;7&quot;
  become: true
  ignore_errors: yes
</code></pre>
<h2 id="parameters">Parameters</h2>
<p>When changing the parameters in the /etc/zabbix/zabbix_proxy.conf config, you need to restart the proxy to apply the changes: <code>service zabbix-proxy restart</code> or<code>/etc/init.d/zabbix-proxy restart</code>.</p>
<p>We check the proxy status via <code>service zabbix-server status</code> or if it is not clear<code>journalctl -xe</code> and in the log /var/log/zabbix/zabbix-proxy.log.</p>
<p>To manually pull the configuration from the server without waiting for an automatic request:
zabbix_proxy -R config_cache_reload</p>
<p>In the proxy parameters, there are Pollers - these are processes that poll agents.
A lot of them are needed in two cases: a large network and many unavailable resources are monitored.
The increase in processes puts a lot of stress, thereby consuming precious resources.</p>
<p>There is also an important timeout parameter that needs to be adjusted for current tasks. All checks that do not fit into it will be spent.</p>
<p>If you do not monitor the use of pollers, then triggers of the form "Zabbix unreachable poller processes more than 75% busy" will probably appear, which indicate that their number is not enough.
It can be the same with the cache, especially considering that there are several of them. </p>
<p>https://www.zabbix.com/documentation/5.0/manual/concepts/proxy?s[]=proxy
https://www.zabbix.com/documentation/5.0/manual/distributed_monitoring/proxies?s[]=proxy</p>
    
    



  <!--  
  <h2>Next and previous links</h2>

    Implement the previous and next links to cycle through the pages.
  -->

    
    
    <nav class="pagination">
      
        <a href="../zabbix-agent/" class="pagination--pager" title="install [zabbix-agent]">&laquo; Previous</a>
      
      
      
        <a href="../../useful_programs/"  class="pagination--pager" title="useful opensource programms"/>Next &raquo;</a>
      
    </nav>
    
    



  <!--
    Support repo URL
  -->
  
  
   Built on <a href="https://github.com/notoriginalnik/notoriginalnik.github.io">GitHub</a>
  
  
  
   with <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/notoriginalnik/mkdocs-pure">Pure theme</a>
  
  </div>
</div>

</div>
</body>
</html>